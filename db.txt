-- 1. Table des Administrateurs
CREATE TABLE administrateurs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR NOT NULL UNIQUE,
    noms VARCHAR NOT NULL,
    cree_le TIMESTAMP DEFAULT NOW()
);

-- 2. Table des Projets
CREATE TABLE projets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    nom VARCHAR NOT NULL,
    publishable_key VARCHAR NOT NULL UNIQUE,
    secret_key_hash VARCHAR NOT NULL UNIQUE,
    origines_autorisees VARCHAR[] DEFAULT '{}',
    est_actif BOOLEAN DEFAULT TRUE,
    administrateur_id UUID NOT NULL REFERENCES administrateurs(id) ON DELETE CASCADE,
    cree_le TIMESTAMP DEFAULT NOW()
);

-- 3. Table des Utilisateurs
CREATE TABLE utilisateurs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR NOT NULL UNIQUE,
    google_id VARCHAR UNIQUE,
    noms VARCHAR,
    avatar_url VARCHAR,
    projet_id UUID NOT NULL REFERENCES projets(id) ON DELETE CASCADE,
    derniere_connexion TIMESTAMP,
    cree_le TIMESTAMP DEFAULT NOW()
);

-- 4. Table des Sessions
CREATE TABLE sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    refresh_token VARCHAR NOT NULL UNIQUE,
    user_agent VARCHAR,
    adresse_ip VARCHAR,
    expire_le TIMESTAMP NOT NULL,
    projet_id UUID NOT NULL REFERENCES projets(id) ON DELETE CASCADE,
    utilisateur_id UUID NOT NULL REFERENCES utilisateurs(id) ON DELETE CASCADE,    
    cree_le TIMESTAMP DEFAULT NOW()
);
